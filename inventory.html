<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MessPro Admin - Inventory</title>
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="inventory.css">
</head>
<body>
   <nav class="admin-nav">
    <div class="logo">MessPro Admin</div>
    <div class="nav-links">
        <a href="index3.html">Home</a>
        <a href="admin.html">Dashboard</a>
        <a href="users.html" >User Management</a>
        <a href="inventory.html" class="active">Inventory</a>
    </div>
    <button class="logout-btn" onclick="adminLogout()">Admin Logout</button>
    </nav>

    <div class="inventory-container">
        <h2>Mess Stock Inventory</h2>
        
        <div class="inventory-grid">
            <div class="stock-item">
                <div class="stock-info">
                    <h3>Rice</h3>
                    <p>Stock: 120 KG</p>
                </div>
                <div class="progress-bar"><div class="fill green" style="width: 80%;"></div></div>
            </div>

            <div class="stock-item">
                <div class="stock-info">
                    <h3>Cooking Oil</h3>
                    <p>Stock: 15 Liters</p>
                </div>
                <div class="progress-bar"><div class="fill red" style="width: 15%;"></div></div>
                <span class="alert">Low Stock!</span>
            </div>

            <div class="stock-item">
                <div class="stock-info">
                    <h3>Vegetables</h3>
                    <p>Stock: 45 KG</p>
                </div>
                <div class="progress-bar"><div class="fill yellow" style="width: 45%;"></div></div>
            </div>
        </div>
    </div>
    <div class="inventory-container" style="padding: 20px; background: #050a10; color: white; min-height: 100vh;">
    <h2 style="color: #00ff88;"><i class="fas fa-boxes"></i> Inventory Management</h2>
    
    <div style="background: #0d1621; padding: 20px; border-radius: 12px; margin-bottom: 30px; border: 1px solid #1a2635;">
        <input type="text" id="itemName" placeholder="Item Name (e.g. Rice)" style="background: #1a2635; border: none; padding: 10px; color: white; border-radius: 5px; margin-right: 10px;">
        <input type="number" id="itemQty" placeholder="Quantity" style="background: #1a2635; border: none; padding: 10px; color: white; border-radius: 5px; margin-right: 10px; width: 80px;">
        <input type="text" id="itemUnit" placeholder="Unit (kg/ltr)" style="background: #1a2635; border: none; padding: 10px; color: white; border-radius: 5px; margin-right: 10px; width: 80px;">
        <button onclick="updateInventory()" style="background: #00ff88; color: black; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer;">Update Stock</button>
    </div>

    <table style="width: 100%; border-collapse: collapse; background: #0d1621; border-radius: 12px; overflow: hidden;">
        <thead style="background: #1a2635; color: #00ff88;">
            <tr>
                <th style="padding: 15px; text-align: left;">Item Name</th>
                <th style="padding: 15px; text-align: left;">In Stock</th>
                <th style="padding: 15px; text-align: left;">Last Updated</th>
            </tr>
        </thead>
        <tbody id="inventoryBody">
            </tbody>
    </table>
</div>

<script>
// 1. Fetch Inventory from SQLite
async function loadInventory() {
    try {
        const res = await fetch('/api/inventory');
        const data = await res.json();
        const body = document.getElementById('inventoryBody');
        
        body.innerHTML = data.map(item => `
            <tr style="border-bottom: 1px solid #1a2635;">
                <td style="padding: 15px;">${item.item_name}</td>
                <td style="padding: 15px;">
                    <span style="color: ${item.quantity < 10 ? '#ff4d4d' : '#00ff88'}">
                        ${item.quantity} ${item.unit}
                    </span>
                </td>
                <td style="padding: 15px; color: #718096; font-size: 0.8rem;">
                    ${new Date(item.last_updated).toLocaleString()}
                </td>
            </tr>
        `).join('');
    } catch (err) {
        console.error("Error loading inventory:", err);
    }
}

// 2. Update Stock in messpro.db
async function updateInventory() {
    const payload = {
        item_name: document.getElementById('itemName').value,
        quantity: document.getElementById('itemQty').value,
        unit: document.getElementById('itemUnit').value
    };

    const res = await fetch('/api/inventory/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });

    if (res.ok) {
        alert("Inventory Updated!");
        loadInventory(); // Refresh the table
        document.getElementById('itemName').value = '';
        document.getElementById('itemQty').value = '';
    }
}

window.onload = loadInventory;
</script>
</body>
</html>